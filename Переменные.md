
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞: –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ä–∏—Å–∫–∞ —Å–µ—Ä–¥–µ—á–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—É–ø–∞

## –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
```python
RANDOM_STATE = 42
TARGET_COL = 'heart_attack_risk_binary'
```

### –ü—É—Ç–∏ –∫ –¥–∞–Ω–Ω—ã–º
```python
DATA_ROOT = Path(os.getenv("DATA_ROOT", "datasets"))
CSV_PATHS = {
    "heart_train.csv": DATA_ROOT / "heart_train.csv",
    "heart_test.csv": DATA_ROOT / "heart_test.csv"
}
```

### –°–ø–∏—Å–∫–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
```python
ANAMNESIS_COLS = [
    'diabetes', 'family_history', 'smoking', 'obesity',
    'alcohol_consumption', 'previous_heart_problems',
    'medication_use', 'stress_level', 'physical_activity_days_per_week'
]
```

### –û–ø–∏—Å–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
```python
COLUMN_DESCRIPTIONS = {
    'id': '—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–∞',
    'age': '–≤–æ–∑—Ä–∞—Å—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞',
    'cholesterol': '—É—Ä–æ–≤–µ–Ω—å —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω–∞ –≤ –∫—Ä–æ–≤–∏',
    'heart_rate': '—á–∞—Å—Ç–æ—Ç–∞ —Å–µ—Ä–¥–µ—á–Ω—ã—Ö —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π',
    'diabetes': '–Ω–∞–ª–∏—á–∏–µ –¥–∏–∞–±–µ—Ç–∞',
    'family_history': '–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–µ–¥—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å',
    'smoking': '—Å—Ç–∞—Ç—É—Å –∫—É—Ä–µ–Ω–∏—è',
    'obesity': '–Ω–∞–ª–∏—á–∏–µ –æ–∂–∏—Ä–µ–Ω–∏—è',
    'alcohol_consumption': '—É—Ä–æ–≤–µ–Ω—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –∞–ª–∫–æ–≥–æ–ª—è',
    'exercise_hours_per_week': '—á–∞—Å—ã —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –≤ –Ω–µ–¥–µ–ª—é',
    'diet': '—Ç–∏–ø –ø–∏—Ç–∞–Ω–∏—è',
    'previous_heart_problems': '–ø–µ—Ä–µ–Ω–µ—Å—ë–Ω–Ω—ã–µ —Å–µ—Ä–¥–µ—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã',
    'medication_use': '–ø—Ä–∏—ë–º —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤',
    'stress_level': '—É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞',
    'sedentary_hours_per_day': '—á–∞—Å—ã —Å–∏–¥—è—á–µ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏ –≤ –¥–µ–Ω—å',
    'income': '—É—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞',
    'bmi': '–∏–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (–ò–ú–¢)',
    'triglycerides': '—É—Ä–æ–≤–µ–Ω—å —Ç—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥–æ–≤ –≤ –∫—Ä–æ–≤–∏',
    'physical_activity_days_per_week': '–¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ —Å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é',
    'sleep_hours_per_day': '—á–∞—Å–æ–≤ —Å–Ω–∞ –≤ —Å—É—Ç–∫–∏',
    'heart_attack_risk_binary': '—Ä–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—É–ø–∞ (üíõ —Ü–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è)',
    'blood_sugar': '—É—Ä–æ–≤–µ–Ω—å —Å–∞—Ö–∞—Ä–∞ –≤ –∫—Ä–æ–≤–∏',
    'ck_mb': '—É—Ä–æ–≤–µ–Ω—å –∫—Ä–µ–∞—Ç–∏–Ω–∫–∏–Ω–∞–∑—ã-MB –≤ –∫—Ä–æ–≤–∏ (üö® –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ä–∫–µ—Ä)',
    'troponin': '—É—Ä–æ–≤–µ–Ω—å —Ç—Ä–æ–ø–æ–Ω–∏–Ω–∞ –≤ –∫—Ä–æ–≤–∏ (üö® –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ä–∫–µ—Ä)',
    'gender': '–ø–æ–ª –ø–∞—Ü–∏–µ–Ω—Ç–∞',
    'systolic_blood_pressure': '—Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ',
    'diastolic_blood_pressure': '–¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ',
    'missing_anamnesis': '–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–∞–º–Ω–µ–∑–∞',
    'invalid_blood_pressure': '–∞–Ω–æ–º–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ'
}
```

## –î–∞–Ω–Ω—ã–µ (DataFrames)

### –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞—Ç–∞—Å–µ—Ç—ã
- `train_df`: –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ `./datasets/heart_train.csv`, —Å–æ–¥–µ—Ä–∂–∏—Ç 8685 —Å—Ç—Ä–æ–∫ –∏ 27 –∫–æ–ª–æ–Ω–æ–∫ (–≤–∫–ª—é—á–∞—è `id` –∏ `heart_attack_risk_binary`)
- `test_df`: –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ `./datasets/heart_test.csv`, —Å–æ–¥–µ—Ä–∂–∏—Ç 966 —Å—Ç—Ä–æ–∫ –∏ 26 –∫–æ–ª–æ–Ω–æ–∫ (–±–µ–∑ —Ç–∞—Ä–≥–µ—Ç–∞)

> –û–±–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ –±—ã–ª–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ —Ñ–æ—Ä–º–∞—Ç—É `snake_case`

### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- `missing_anamnesis`: —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–∞–º–Ω–µ—Å—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ–ø—É—Å–∫–∏ –≤ `ANAMNESIS_COLS`)
- `invalid_blood_pressure`: —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –∞–Ω–æ–º–∞–ª–∏—é –¥–∞–≤–ª–µ–Ω–∏—è (–∫–æ–≥–¥–∞ —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ ‚â§ –¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–≥–æ)

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –º–æ–¥—É–ª–∏

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ
```python
import json
import os
from pathlib import Path

import joblib
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import seaborn as sns
import shap

from catboost import CatBoostClassifier
from sklearn.metrics import (
    RocCurveDisplay,
    auc,
    classification_report,
    confusion_matrix,
    f1_score,
    precision_recall_curve,
    precision_score,
    recall_score,
    roc_auc_score
)
from sklearn.model_selection import train_test_split
```

### –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
```python
from src.preprocessing.data_preprocessor import DataPreprocessor
from utils.viz import *
```

## –ú–æ–¥–µ–ª—å –∏ –º–µ—Ç—Ä–∏–∫–∏

### –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
- –¢–∏–ø: `CatBoostClassifier`
- –¶–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `heart_attack_risk_binary`
- –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏: **0.42**

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| **F1-score (–∫–ª–∞—Å—Å 1)** | **0.528** |
| **Recall (–∫–ª–∞—Å—Å 1)** | **0.947** |
| **Precision (–∫–ª–∞—Å—Å 1)** | **0.366** |
| **ROC AUC** | **0.569** |

> –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–º –Ω–∞–±–æ—Ä–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏.

## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

### –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
```python
./models/heart_risk_model.cbm          # –ë–∏–Ω–∞—Ä–Ω–∞—è –º–æ–¥–µ–ª—å CatBoost
./models/model_features.json           # –°–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –º–æ–¥–µ–ª–∏
./models/optimal_threshold.json        # –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ (0.42)
./models/preprocessing_config.json     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞
```

### –ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `optimal_threshold.json`
```json
{"threshold": 0.42}
```

### –ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `model_features.json`
```json
[
  "age",
  "cholesterol",
  "heart_rate",
  "diabetes",
  "family_history",
  "smoking",
  "obesity",
  "alcohol_consumption",
  "exercise_hours_per_week",
  "diet",
  "previous_heart_problems",
  "medication_use",
  "stress_level",
  "sedentary_hours_per_day",
  "income",
  "bmi",
  "triglycerides",
  "physical_activity_days_per_week",
  "sleep_hours_per_day",
  "blood_sugar",
  "ck_mb",
  "troponin",
  "gender",
  "systolic_blood_pressure",
  "diastolic_blood_pressure",
  "missing_anamnesis",
  "invalid_blood_pressure"
]
```

> **–í–∞–∂–Ω–æ**: —Ö–æ—Ç—è –≤ –Ω–æ—É—Ç–±—É–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ. –¢–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `model_features.json` –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è.

## –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

- –†–∞–∑–±–∏–µ–Ω–∏–µ: `train_test_split` —Å `random_state=42`.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏: –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏.
- –í—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ FastAPI.
