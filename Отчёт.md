# Отчёт по проекту М1: Предсказание риска сердечного приступа

## Общая информация
- **Цель проекта**: Разработать модель машинного обучения для предсказания риска сердечных приступов на основе данных пациентов.
- **Датасеты**:
  - Train: 8685 строк, 28 колонок
  - Test: 966 строк, 27 колонок (без таргета)

## Исследование датасета (EDA)

### Загрузка и первичный анализ данных
- **Выполнено**: Загружены датасеты `heart_train.csv` и `heart_test.csv`
- **Выявлено**:
  - Все идентификаторы (`id`) уникальны
  - Наличие колонки `Unnamed: 0` (совпадает с индексом)

### Анализ типов данных и пропусков
- **Выполнено**: Проверены типы данных, пропуски и дубликаты
- **Выявлено**:
  - **Типы данных**: `float64` (24), `int64` (3), `object` (1)
  - **Пропуски**: Систематические пропуски в 9 колонках (243 строки в train, 31 в test)
  - **Дубликаты**: Отсутствуют

### Анализ целевого признака
- **Выполнено**: Проанализировано распределение таргета
- **Выявлено**:
  - Класс 0 (низкий риск): 65.31%
  - Класс 1 (высокий риск): 34.69%
  - **Вывод**: Классы несбалансированы. Рекомендованы метрики F1-score, ROC-AUC

### Анализ корреляций и поиск утечек данных
- **Выполнено**: Вычислены корреляции с таргетом и между признаками
- **Выявлено**:
  - Максимальная корреляция с таргетом: 0.044 (`Diet`)
  - Сильной мультиколлинеарности нет
  - Прямых утечек данных не обнаружено

### Детальный анализ признаков
- **Выполнено**: Базовая статистика, анализ выбросов, категориальных признаков
- **Выявлено**:
  - Большинство признаков нормализованы (диапазон 0–1)
  - **Выбросы**: Высокая доля в `Blood sugar`, `CK-MB`, `Troponin` (24.57%)
  - **`Gender`**: Аномалия - 4 значения (`'Male'`, `'Female'`, `'1.0'`, `'0.0'`)
  - Различия в средних значениях признаков между классами минимальны

## Предобработка данных

### Удаление ненужных колонок
- Удалена колонка `Unnamed: 0`

### Преобразование типов и кодирование категориальных признаков
- **Таргет**: Преобразован из `float64` в `int64`
- **`Gender`**: Закодирован как `{'Male': 0, 'Female': 1, '1.0': 2, '0.0': 3}`
- **Итоговые типы**: `float64` (23), `int64` (4)

## Обучение и оптимизация модели

### Подход
- Отказ от полной модели из-за переобучения.
- Выбор **упрощённой модели** на основе SHAP-анализа и медицинской логики.
- Использование **ручного подбора порога** для максимизации F1-score класса «высокий риск».

### Финальная модель
- **Алгоритм**: `CatBoostClassifier`
- **Гиперпараметры**:
  ```python
  {
      'iterations': 300,
      'depth': 3,
      'scale_pos_weight': 1.88,
      'random_state': 42
  }
  ```
- **Признаки**: 15 ключевых (`bmi`, `triglycerides`, `missing_anamnesis`, `invalid_blood_pressure` и др.)

### Ключевые находки
- **`missing_anamnesis`**: пациенты без анамнеза всегда имеют низкий риск (`target=0`)
- **`invalid_blood_pressure`**: флаг `systolic <= diastolic` - сильный сигнал риска
- **Утечки данных**: исключены признаки `ck_mb`, `troponin`

### Результаты (валидация)
| Метрика | Значение |
|--------|----------|
| **Recall (класс 1)** | **0.947** |
| **F1-score (класс 1)** | **0.528** |
| **ROC AUC** | **0.924** |
| **Оптимальный порог** | **0.42** |

### Артефакты
- Модель сохранена как `models/heart_risk_model.cbm`
- Список признаков: `models/model_features.json`
- Оптимальный порог: `models/optimal_threshold.json`

### Совместимость с проверяющим скриптом
- Приложение генерирует CSV-файл `submission.csv` с колонками:
  - `id`
  - `prediction` (0 или 1)
- Формат полностью соответствует требованиям:
  ```csv
  id,prediction
  7746,1
  9613,0
  ...
  ```

